{% extends "layout.html" %}

{% block title %}Reset Password{% endblock %}

{% block content %}
<!-- Card container for password reset forms -->
    <div class="signup-card mx-auto mt-5">
        <h2>Reset Password</h2>

    <!-- Step 1: Ask for username -->
        {% if step == 1 %}
            <form method="POST" action="{{ url_for('forget_password') }}">
                <div class="mb-3">
                    <input type="text" name="username" placeholder="Enter your username" class="form-control" required>
                </div>
                <button type="submit" class="btn btn-custom form-control">Next</button>
            </form>
        {% endif %}

    <!-- Step 2: Ask for security question answer -->
        {% if step == 2 %}
            <form method="POST" action="{{ url_for('forget_password') }}">
        <!-- Keep the username hidden to pass to next step -->
                <input type="hidden" name="username" value="{{ username }}">
                <div class="mb-3">
            <!-- Display the security question as placeholder -->
                    <input type="text" name="answer" placeholder="{{ question }}" class="form-control" required>
                </div>
                <button type="submit" class="btn btn-custom form-control">Verify</button>
            </form>
        {% endif %}

    <!-- Step 3: Allow user to set new password -->
        {% if step == 3 %}
            <form method="POST" action="{{ url_for('forget_password') }}">
        <!-- Keep username and answer hidden -->
                <input type="hidden" name="username" value="{{ username }}">
                <input type="hidden" name="answer" value="{{ request.form.get('answer') }}">

        <!-- New password input -->
                <div class="mb-3 position-relative">
                    <input type="password" name="new_password" id="new_password" placeholder="New Password" class="form-control" required>
                    <i class="fa-solid fa-eye me-3" onclick="togglePassword('new_password', this)" style="cursor:pointer; position:absolute; right:10px; top:50%; transform:translateY(-50%)"></i>
                </div>

        <!-- Confirm password input -->
                <div class="mb-3 position-relative">
                    <input type="password" name="confirm_password" id="confirm_password" placeholder="Confirm Password" class="form-control" required>
                    <i class="fa-solid fa-eye me-3" onclick="togglePassword('confirm_password', this)" style="cursor:pointer; position:absolute; right:10px; top:50%; transform:translateY(-50%)"></i>
                </div>

                <button type="submit" class="btn btn-custom form-control">Reset Password</button>
            </form>
        {% endif %}

    <!-- Link to return to login page -->
        <a href="{{ url_for('login') }}">Back to Login</a>
    </div>

<!-- Password visibility toggle script -->
    <script>
    /**
     * Toggles visibility of password input fields.
     * @param {string} id - The ID of the password input field.
     * @param {HTMLElement} icon - The eye icon clicked to toggle visibility.
     */
        function togglePassword(id, icon) {
            const input = document.getElementById(id);
            if (input.type === "password") {
                input.type = "text"; // Show password
                icon.classList.remove("fa-eye");
                icon.classList.add("fa-eye-slash");
            } else {
                input.type = "password"; // Hide password
                icon.classList.remove("fa-eye-slash");
                icon.classList.add("fa-eye");
            }
        }
    </script>
{% endblock %}
